{"config":{"lang":["pt"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"SMNAMonitoringApp","text":""},{"location":"#smnamonitoringapp","title":"SMNAMonitoringApp","text":"<p>O SMNAMonitoringApp \u00e9 uma aplica\u00e7\u00e3o do tipo dashboard que permite a visualiza\u00e7\u00e3o e a verifica\u00e7\u00e3o dos resultados do Sistema de Modelagem Num\u00e9rica e Assimila\u00e7\u00e3o de dados (SMNA). O SMNA \u00e9 o sistema de assimila\u00e7\u00e3o de dados do Centro de Previs\u00e3o de Tempo e Estudos Clim\u00e1tico (CPTEC) e \u00e9 composto pelo modelo num\u00e9rico Brazilian Atmospheric Model (BAM) e pelo sistema de assimila\u00e7\u00e3o de dados Gridpoint Statistical Interpolation (GSI).</p> <p></p> <p>Vers\u00e3o de demonstra\u00e7\u00e3o dispon\u00edvel no HuggingFace Spaces.</p> <p></p>"},{"location":"desenvolvimento/","title":"Desenvolvimento","text":""},{"location":"instalacao/","title":"Instala\u00e7\u00e3o","text":""},{"location":"instalacao/#instalacao","title":"Instala\u00e7\u00e3o","text":"<p>A instala\u00e7\u00e3o do SMNAMonitoringApp deve ser feita atrav\u00e9s da cria\u00e7\u00e3o do ambiente Python com todos os pacotes e vers\u00f5es necess\u00e1rias para o seu funcionamento.</p>"},{"location":"instalacao/#criacao-do-ambiente","title":"Cria\u00e7\u00e3o do ambiente","text":"<p>Antes de criar o ambiente, obtenha uma c\u00f3pia do SMNAMonitoringApp a partir do reposit\u00f3rio GitHub:</p> <pre><code>git clone https://github.com/GAD-DIMNT-CPTEC/SMNAMonitoringApp.git\n</code></pre> <p>Para criar o ambiente, utilize o arquivo <code>environment.yml</code> que est\u00e1 na sua c\u00f3pia local do reposit\u00f3rio:</p> <pre><code>cd SMNAMonitoringApp\nconda env create -f environment.yml\n</code></pre> <p>Com isso, voc\u00ea j\u00e1 deve ter um ambiente adequado para a utiliza\u00e7\u00e3o do SMNAMonitoringApp.</p>"},{"location":"introducao/","title":"Introdu\u00e7\u00e3o","text":""},{"location":"introducao/#introducao","title":"Introdu\u00e7\u00e3o","text":"<p>O SMNAMonitoringApp \u00e9 uma aplica\u00e7\u00e3o do tipo dashboard que permite a visualiza\u00e7\u00e3o e a verifica\u00e7\u00e3o dos resultados do Sistema de Modelagem Num\u00e9rica e Assimila\u00e7\u00e3o de dados (SMNA). O SMNA \u00e9 o sistema de assimila\u00e7\u00e3o de dados do Centro de Previs\u00e3o de Tempo e Estudos Clim\u00e1tico (CPTEC) e \u00e9 composto pelo modelo num\u00e9rico Brazilian Atmospheric Model (BAM) e pelo sistema de assimila\u00e7\u00e3o de dados Gridpoint Statistical Interpolation (GSI).</p> <p>Devido \u00e0 necessidade de acompanhar e verificar os resultados e processos relacionados ao SMNA, fez-se necess\u00e1rio desenvolver um ambiente que re\u00fane todas as informa\u00e7\u00f5es pertinentes a cada processo, de forma que a sua visualiza\u00e7\u00e3o permite insights sobre tais processos. Nesse sentido, a estrutura de software do SMNAMonitoringApp compreende n\u00e3o apenas a interface em si, mas tamb\u00e9m o processamento dos dados brutos para que possam ser visualizados na interface. Veja mais detalhes sobre o processamento dos dados brutos na p\u00e1gina Operacional.</p> <p>A interface do SMNAMonitoringApp \u00e9 escrita em linguagem Python e utiliza extensivamente a biblioteca Panel. Todos os elementos de widgets, como bot\u00f5es, seletores das vari\u00e1veis e datas s\u00e3o provenientes desta biblioteca. J\u00e1 os elementos gr\u00e1ficos pertinentes \u00e0 visualiza\u00e7\u00e3o dos gr\u00e1ficos de linha e campos espaciais, em sua maioria s\u00e3o apresentados a partir da biblioteca HVplot e tamb\u00e9m das bibliotecas Cartopy, Matplotlib e Seaborn. Em rela\u00e7\u00e3o ao acesso aos dados, utilizam-se arquivos no formato <code>CSV</code> para os dados tabulados e a biblioteca Intake do Python para acessar os dados bin\u00e1rios. Veja mais detalhes sobre o processamento dos dados brutos na p\u00e1gina Operacional.</p>"},{"location":"operacional/","title":"Operacional","text":""},{"location":"operacional/#operacional","title":"Operacional","text":"<p>O SMNAMonitoringApp possui um conjunto de scripts que s\u00e3o respons\u00e1veis pelo download e processamento dos dados antes de serem apresentados na interface. Quando o usu\u00e1rio visualiza os dados na interface, ele est\u00e1 vendo os dados que j\u00e1 foram processados e armazenados em um servidor de dados. Dessa forma, a cada novo ciclo de assimila\u00e7\u00e3o de dados, estes script s\u00e3o executados para atualizar os dados a serem apresentados na interface. Para a interface, s\u00e3o fornecidos sempre os \u00faltimos 7 dias (ou 28 ciclos) de dados que incluem, an\u00e1lise, background (previs\u00e3o de curto prazo), logs das simula\u00e7\u00f5es (pr\u00e9-processamento do modelo, modelo, p\u00f3s-processamento do modelo e sistema de assimila\u00e7\u00e3o de dados), al\u00e9m de dados com os diagn\u00f3sticos da assimila\u00e7\u00e3o de dados e a contabiliza\u00e7\u00e3o do uso do disco pelas observa\u00e7\u00f5es.</p>"},{"location":"operacional/#processamento-dos-dados-da-tabela-de-status","title":"Processamento dos dados da Tabela de Status","text":"<p>O processamento dos dados da tabela de status utiliza o seguinte algor\u00edtmo:</p> <ol> <li>Verifica\u00e7\u00e3o de quantas vezes cada componente do sistema foi realizada (conta quantos arquivos de log foram gerados);</li> <li>Atribui\u00e7\u00e3o dos emojis para cada situa\u00e7\u00e3o (e.g., \u2705  GOOD, \u2699 WAIT FINISH, \u26a0 CHECK LOGS e \ud83d\udd53 WAIT START);</li> <li>Em determinadas situa\u00e7\u00f5es, quando um n\u00famero de realiza\u00e7\u00f5es for maior do que o necess\u00e1rio, um link para o \u00faltimo log \u00e9 fornecido;</li> <li>Escrita do arquivo <code>CSV</code> final.</li> </ol>"},{"location":"operacional/#processamento-dos-dados-de-analise-e-previsao","title":"Processamento dos dados de An\u00e1lise e Previs\u00e3o","text":"<p>O processamento dos dados de an\u00e1lise e previs\u00e3o utiliza o seguinte algor\u00edtmo:</p> <ol> <li>Download dos dados bin\u00e1rios de an\u00e1lise e previs\u00e3o de 6 horas;</li> <li>Leitura dos dados a partir do software pyBAM e escrita no formato Zarr;</li> <li>Atualiza\u00e7\u00e3o do arquivo de cat\u00e1logo que o SMNAMonitoringApp utilizar\u00e1 para acessar os dados.</li> </ol> <p>O software pyBAM foi escrito para acessar e fornecer estruturas de dados adequadas com o Xarray para a visualiza\u00e7\u00e3o com o matplotlib. No contexto do SMNAMonitoringApp, \u00e9 utilizado apenas para preparar os dados e convet\u00ea-los para o formato Zarr (o que \u00e9 feito com a biblioteca Zarr do Python). Na interface, \u00e9 utilizada a biblioteca Intake para ler o cat\u00e1logo de dados. Como o volume de dados \u00e9 relativamente grande para o tr\u00e1fego pela internet (entre o servidor de dados e o navegador do usu\u00e1rio), utiliza-se a biblioteca Dask para adicionar uma camada de processamento paralelo (i.e., todos os n\u00facleos do processador da m\u00e1quina do usu\u00e1rio s\u00e3o utilizados).</p> <p>A seguir, um exemplo de como os dados de an\u00e1lise s\u00e3o acessados pelo SMNAMonitoringApp:</p> <pre><code>import intake\n...\ncatalog_anl = intake.open_catalog('http://ftp1.cptec.inpe.br/pesquisa/das/carlos.bastarz/SMNAMonitoringApp/anls/catalog_anl.yml')\n...\ndef loadData(lfname):\n    canl = catalog_anl[lfname].to_dask()\n    return canl\n</code></pre> <p>No exemplo acima, a fun\u00e7\u00e3o <code>loadData</code> recebe como argumento a vari\u00e1vel <code>lfname</code> a qual \u00e9 utilizada como o nome da fonte de dados a ser acessada no cat\u00e1logo. O ajuste desta vari\u00e1vel \u00e9 feito atrav\u00e9s da widget de nome <code>date</code> (<code>date = pn.widgets.Select(name='Date', value=date_range[0], options=date_range)</code>) no script <code>monitor_anl.py</code> na interface do SMNAMonitoringApp.</p> <p>A seguir, um exemplo de fonte de dados do cat\u00e1logo <code>catalog_anl.yml</code>:</p> <pre><code>sources:\n\n  '2024040412':\n    args:\n      consolidated: true\n      urlpath: https://s0.cptec.inpe.br/pesquisa/das/dist/carlos.bastarz/SMNAMonitoringApp/anls/2024040412/GFCTCPT20240404122024040412F.icn.TQ0299L064.zarr\n    description: SMNA Analysis for 2024040412\n    driver: intake_xarray.xzarr.ZarrSource\n    metadata: \n      catalog_dir: https://s0.cptec.inpe.br/pesquisa/das/dist/carlos.bastarz/SMNAMonitoringApp/anls/2024040412\n      tags:\n        - atmosphere\n        - analysis\n        - data_assimilation\n        - smna\n        - field\n      url: https://s0.cptec.inpe.br/pesquisa/das/dist/carlos.bastarz/SMNAMonitoringApp/anls/2024040412\n...\n</code></pre>"},{"location":"operacional/#processamento-dos-dados-do-constrain-de-massa","title":"Processamento dos dados do Constrain de Massa","text":"<p>O processamento dos dados de contrain de massa utiliza o seguinte algor\u00edtmo:</p> <ol> <li>Download do arquivo com o banco de dados com os dados do constrain de massa armazenados;</li> <li>Utiliza\u00e7\u00e3o do Sqlite3 para abrir o arquivo de banco de dados e recuperar as informa\u00e7\u00f5es.</li> </ol>"},{"location":"operacional/#processamento-dos-dados-de-minimizacao-da-funcao-custo","title":"Processamento dos dados de Minimiza\u00e7\u00e3o da Fun\u00e7\u00e3o Custo","text":"<p>O processamento dos dados de minimiza\u00e7\u00e3o da fun\u00e7\u00e3o custo utiliza o seguinte algor\u00edtmo:</p> <ol> <li>Download do arquivo de log da \u00faltima realiza\u00e7\u00e3o do sistema de assimila\u00e7\u00e3o de dados;</li> <li>Organiza\u00e7\u00e3o das informa\u00e7\u00f5es:</li> <li>Quanto aos outer e inner loops;</li> <li>Quanto \u00e0s vari\u00e1veis;</li> <li>Quanto ao hor\u00e1rio sin\u00f3tico;</li> <li>Cria\u00e7\u00e3o de uma tabela com as informa\u00e7\u00f5es necess\u00e1rias;</li> <li>Escrita do arquivo <code>CSV</code> com as informa\u00e7\u00f5es.</li> </ol> <p>A seguir, um exemplo de como os dados de minimiza\u00e7\u00e3o da fun\u00e7\u00e3o custo s\u00e3o acessados pelo SMNAMonitoringApp:</p> <pre><code>import pandas as pd\n...\ndfs = pd.read_csv('http://ftp1.cptec.inpe.br/pesquisa/das/carlos.bastarz/SMNAMonitoringApp/jo/jo_table_series.csv', header=[0, 1], parse_dates=[('df_preOper', 'Date'), ('df_JGerd', 'Date')])\n...\ndef plotCurves(variable, experiment, synoptic_time, iter_fcost, date_range):\n    ...\n    df_s = df2.loc[df2['Observation Type'] == variable].loc[df2['Iter'] == iter_fcost].set_index('Date').at_time(str(time_fmt0)).reset_index()    \n    ...\n    ax_nobs = df_s.hvplot.line(x='Date', y='Nobs', xlabel='Date', ylabel=str('Nobs'), persist=True, rot=90, grid=True, label=str(i), line_width=3, height=height, responsive=True)\n    ...\n    return ax_nobs\n</code></pre>"},{"location":"operacional/#processamento-dos-diagnosticos-da-analise","title":"Processamento dos Diagn\u00f3sticos da An\u00e1lise","text":"<p>O processamento dos diagn\u00f3sticos da an\u00e1lise utiliza o seguinte algor\u00edtmo:</p> <ol> <li>Download dos arquivos de diagn\u00f3sticos do sistema de assimila\u00e7\u00e3o de dados;</li> <li>Leitura dos arquivos de diagn\u00f3sticos com o readDiag e escrita dos arquivos de diagn\u00f3sticos (geodataframes) no formato Parquet para cada vari\u00e1vel;</li> <li>Atualiza\u00e7\u00e3o dos cat\u00e1logos que o SMNAMonitoringApp utilizar\u00e1 para acessar os dados.</li> </ol> <p>O software readDiag foi escrito com o objetivo de facilitar o acesso aos arquivos de diagn\u00f3stico do sistema de assimila\u00e7\u00e3o de dados, fornecendo estruturas de dados adequados para a sua visualiza\u00e7\u00e3o.</p> <p>A seguir um exemplo de como o SMNAMonitoringApp acessa o cat\u00e1logo com os dados de diagn\u00f3sticos:</p> <pre><code>import intake\n...\ncatalog_diag_conv_01 = intake.open_catalog('http://ftp1.cptec.inpe.br/pesquisa/das/carlos.bastarz/SMNAMonitoringApp/rdiag/catalog_diag_conv_01.yml')\n...\ndef loadData(lfname):\n    ax = catalog_diag_conv_01[lfname].read()\n    return ax\n...\n</code></pre> <p>A seguir, um exemplo do cat\u00e1logo de dados com os diagn\u00f3sticos da an\u00e1lise:</p> <pre><code>sources:\n\n  'ps_diag_conv_01_2024032700':\n    driver: geoparquet\n    args:\n      urlpath: https://s0.cptec.inpe.br/pesquisa/das/dist/carlos.bastarz/SMNAMonitoringApp/rdiag/2024032700/ps-diag_conv_01.2024032700.parquet\n    description: SMNA PS Conventional Diagnostics (01) for 2024032700\n    metadata: \n      catalog_dir: https://s0.cptec.inpe.br/pesquisa/das/dist/carlos.bastarz/SMNAMonitoringApp/rdiag/2024032700\n      tags:\n        - atmosphere\n        - data_assimilation\n        - smna\n        - observational diagnostic data\n      url: https://s0.cptec.inpe.br/pesquisa/das/dist/carlos.bastarz/SMNAMonitoringApp/rdiag/2024032700\n...\n</code></pre>"},{"location":"operacional/#processamento-das-covariancias-dos-erros-de-previsao","title":"Processamento das Covari\u00e2ncias dos Erros de Previs\u00e3o","text":"<p>O processamento das covari\u00e2ncias dos erros de previs\u00e3o \u00e9 mais simples do que os demais processamentos, visto que a matriz de covari\u00e2ncias em uso pelo SMNA \u00e9 est\u00e1tica (i.e., n\u00e3o \u00e9 atualizada a cada ciclo de previs\u00e3o). O seu processamento \u00e9 feito da seguinte forma:</p> <ol> <li>Download do arquivo com a matriz de covari\u00e2ncias;</li> <li>Leitura com o GSIBerror e escrita no formato Zarr;</li> <li>Escrita do arquivo de cat\u00e1logo com as fontes de dados da matriz de covari\u00e2ncias.</li> </ol> <p>O software GSIBerror foi escrito para permitir a leitura do arquivo bin\u00e1rio da matriz de covari\u00e2ncias dos erros de previs\u00e3o em uso pelo sistema de assimila\u00e7\u00e3o do SMNA.</p> <p>Um exemplo da leitura do cat\u00e1logo de dados da matriz de covari\u00e2ncias:</p> <pre><code>import intake\n...\ncatalog_berror = intake.open_catalog('http://ftp1.cptec.inpe.br/pesquisa/das/carlos.bastarz/SMNAMonitoringApp/berror/catalog_berror.yml')\n...\n</code></pre> <p>Um exemplo do cat\u00e1logo de dados da matriz de covari\u00e2ncias:</p> <pre><code>sources:\n\n  'balprojs_agvin':\n    args:\n      consolidated: true\n      urlpath: https://s0.cptec.inpe.br/pesquisa/das/dist/carlos.bastarz/SMNAMonitoringApp/berror/smna_berror_balprojs_agvin.zarr\n    description: Vertical Projection of the Stream Function over the Vertical Profile of the Balanced Part of Virtual Temperature\n    driver: intake_xarray.xzarr.ZarrSource\n    metadata:\n      catalog_dir: https://s0.cptec.inpe.br/pesquisa/das/dist/carlos.bastarz/SMNAMonitoringApp/berror\n      tags:\n        - atmosphere\n        - ocean\n        - analysis\n        - data_assimilation\n        - smna\n        - background error covariance matrix\n      url: https://s0.cptec.inpe.br/pesquisa/das/dist/carlos.bastarz/SMNAMonitoringApp/anls/berror\n...      \n</code></pre>"},{"location":"utilizacao/","title":"Utiliza\u00e7\u00e3o","text":""},{"location":"utilizacao/#utilizacao","title":"Utiliza\u00e7\u00e3o","text":"<p>O SMNAMonitoringApp \u00e9 uma aplica\u00e7\u00e3o do tipo dashboard e a sua utiliza\u00e7\u00e3o \u00e9 feita atrav\u00e9s do seu navegador de internet. Para abrir uma se\u00e7\u00e3o do SMNAMonitoringApp, abra o terminal e digite os comandos:</p> <pre><code>conda activate SMNAMonitoringApp\ncd SMNAMonitoringApp\n./SMNAMonitoringApp\n</code></pre> <p>Com isso, o navegador de internet dever\u00e1 ser carregado e a tela inicial do SMNAMonitoringApp ser\u00e1 exibida:</p> <p></p> <p>Dica</p> <p>Para uma melhor experi\u00eancia, pressione a tecla <code>F11</code> para fazer o seu navegador entrar em tela cheia.</p>"}]}